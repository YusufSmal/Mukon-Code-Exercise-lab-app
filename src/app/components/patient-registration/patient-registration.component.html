<div class="container mt-4">
  <mat-card class="MainCard">
    <h3>Patient Registration</h3>
    <form [formGroup]="registrationForm" (ngSubmit)="savePatient()">

      <mat-card-content>
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Requisition ID (0001-9999)</mat-label>
          <input matInput formControlName="requisitionId" type="text" placeholder="e.g. 1234" [ngClass]="{'is-invalid': registrationForm.get('requisitionId')?.invalid && registrationForm.get('requisitionId')?.touched}" />
          <mat-error *ngIf="registrationForm.get('requisitionId')?.invalid && registrationForm.get('requisitionId')?.touched">
            Requisition ID is required and must be 4 digits.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-100">
          <mat-label>First Name</mat-label>
          <input matInput formControlName="firstName" type="text" placeholder="e.g. John" [ngClass]="{'is-invalid': registrationForm.get('firstName')?.invalid && registrationForm.get('firstName')?.touched}" />
          <mat-error *ngIf="registrationForm.get('firstName')?.invalid && registrationForm.get('firstName')?.touched">
            First Name is required.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Surname</mat-label>
          <input matInput formControlName="surname" type="text" placeholder="e.g. Doe" [ngClass]="{'is-invalid': registrationForm.get('surname')?.invalid && registrationForm.get('surname')?.touched}" />
          <mat-error *ngIf="registrationForm.get('surname')?.invalid && registrationForm.get('surname')?.touched">
            Surname is required.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Gender</mat-label>
          <mat-select formControlName="gender">
            <mat-option value="M">Male</mat-option>
            <mat-option value="F">Female</mat-option>
            <mat-option value="U">Unspecified</mat-option>
          </mat-select>
          <mat-error *ngIf="registrationForm.get('gender')?.invalid && registrationForm.get('gender')?.touched">
            Gender is required.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Date of Birth</mat-label>
          <input matInput formControlName="dateOfBirth" type="date" [ngClass]="{'is-invalid': registrationForm.get('dateOfBirth')?.invalid && registrationForm.get('dateOfBirth')?.touched}" />
          <mat-error *ngIf="registrationForm.get('dateOfBirth')?.invalid && registrationForm.get('dateOfBirth')?.touched">
            Date of Birth is required.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Mobile Number (+27...)</mat-label>
          <input matInput formControlName="mobileNumber" type="text" placeholder="e.g. +27123456789" [ngClass]="{'is-invalid': registrationForm.get('mobileNumber')?.invalid && registrationForm.get('mobileNumber')?.touched}" />
          <mat-error *ngIf="registrationForm.get('mobileNumber')?.invalid && registrationForm.get('mobileNumber')?.touched">
            Mobile Number is required and must start with +27.
          </mat-error>
        </mat-form-field>

            <div class="form-field-container">
              <label class="mat-label mb-2">Select Tests</label>
              <div class="checkbox-group">
                <div *ngFor="let test of tests" class="mb-2">
                  <mat-checkbox [value]="test.TestId.toString()" 
                              (change)="onTestSelection($event, test.TestId)">
                    {{ test.Mnemonic }} - {{ test.Description }}
                  </mat-checkbox>
                </div>
              </div>
              <mat-error *ngIf="registrationForm.get('selectedTests')?.invalid && registrationForm.get('selectedTests')?.touched">
                At least one test must be selected.
              </mat-error>
            </div>

        <button mat-raised-button color="primary" class="mt-3" type="submit" [disabled]="registrationForm.invalid">
          Register
        </button>
      </mat-card-content>
    </form>
  </mat-card>
</div>
